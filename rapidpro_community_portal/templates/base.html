{% load compress static wagtailuserbar %}
{% load wagtailcore_tags wagtailimages_tags %}
{% load portal_extras %}

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="IE=10" http-equiv="X-UA-Compatible">

        <title>
            {% block title %}{% if self.seo_title %}{{ self.seo_title }}{% else %}{{ self.title }}{% endif %}{% endblock %}
            {% block title_postfix %}{% endblock %}
        </title>

        <link href="{% static 'images/rapidpro.ico' %}" type="image/ico" rel="shortcut icon">

        <meta name="description" content="{% if self.search_description %}{{ self.search_description }}{% endif %}">

        {# Caktus stylesheets #}
        <link href="{% static 'css/wildcard.css' %}" type="text/css" rel="stylesheet">
        <link href="{% static 'css/layout.css' %}" type="text/css" rel="stylesheet">
        <link href="{% static 'css/main.css' %}" type="text/css" rel="stylesheet">
        <link href="{% static 'css/flickity.css' %}" type="text/css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,700,400italic,700italic" type="text/css" rel="stylesheet">

        <script type="text/javascript" src="{% static 'js/flickity.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/uservoice.js' %}"></script>

        {% block extra_css %}{% endblock %}
    </head>

    <body onload="loadSubNav('');">
        {% wagtailuserbar %}

        {# TODO: split out into an include #}
        {# TODO: figure out meshing fixed/dynamic content for this #}
        {% block top-nav %}
        <header class="main-nav">
            <div class="page-width cushion">
                <a href="/">
                    <img alt="RapidPro" src="{% static 'images/svg/rapidpro_logo_optimized.svg' %}" class="logo left">
                </a>
                <nav class="right">
                    <a class="skip-link" href="#content">Skip Link</a>
                    <a id="nav_learn" href="javascript:loadSubNav('learn');">Learn</a>
                    <a id ="nav_connect" href="javascript:loadSubNav('connect')">Connect</a>
                    <a id="nav_stories" href="/stories/">
                        Stories
                    </a>
                    <a id="nav_develop" target="_blank" href="https://github.com/rapidpro/">Develop</a>
                    <a id="nav_freedemo" target="_blank" class="button" href="#">Free Demo</a>
                </nav>
                <div class="clear"></div>
            </div>
        </header>
        <header class="sub-nav">
          <div class="page-width">
            <nav id="subnav_right" class="right">
            </nav>
          </div>
        </header>
        {% endblock %}

        {% block top-image %}

            {% randomize_image self as top_image %}

            {% if top_image %}
                {% image top_image width-1000 as topimagedata %}
                <style>
                  .top-image
                  {
                    background-image: url({{ topimagedata.url }});
                  }
                </style>
            {% endif %}

            <section class="top-image" alt="{{ self.top_image.title }}">
                <div class="page-width">
                </div>
            </section>
        {% endblock %}

        {% block heading %}{% endblock %}

        {% block full-content %}
        <section class="content">
            <div class="page-width float-layout">
                {% block content %}{% endblock %}
            </div>
        </section>
        {% endblock %}

        <div class="spacer"></div>

        {% block bottom-nav %}
        <footer>
            <div class="page-width">
                <div class="cushion">
                    <img alt="RapidPro" src="{% static 'images/svg/rapidpro_logo_optimized.svg' %}" class="logo left">
                    <div class="clear spacer"></div>
                    <p>Copyright &copy; {% now "Y" %} UNICEF</p>
                </div>
            </div>
        </footer>
        {% endblock %}

        {% block nav-js %}
            <script>
                function loadSubNav(subnavType) {
                    subnavHeadersArray = [];
                    subnavLinksArray = [];                    
                    if(window.location.pathname == "/stories/") {
                        clearAllNavClasses();
                        document.getElementById('nav_stories').className = 'selected';
                        subnavHeadersArray = [];
                        subnavLinksArray = [];
                        subnavTargetArray = [];
                    }
                    switch(subnavType) {
                        case "learn":
                            subnavHeadersArray = ["Knowledge Base", "Videos", "Online Courses"];
                            subnavLinksArray = ["http://rapidpro1.uservoice.com/knowledgebase", "videos/", "online_courses/"];
                            subnavTargetArray = ["_blank", "_blank", "_blank"];
                            clearAllNavClasses();
                            document.getElementById('nav_learn').className = 'selected';                           
                            break;
                        case "connect":
                            subnavHeadersArray = ["User Forum", "Blog"];
                            subnavLinksArray = ["forum/", "blog/"];
                            subnavTargetArray = ["_blank", ""];
                            clearAllNavClasses();
                            document.getElementById('nav_connect').className = 'selected';
                            break;
                    }
                    subnavHTML = "<a href='#'></a>";
                    for (var i = 0; i < subnavHeadersArray.length; i++) {
                        subnavHTML = subnavHTML + "<a href='" + subnavLinksArray[i] + "' target='" + subnavTargetArray[i] + "'>" + subnavHeadersArray[i] + "</a>";
                    }
                    document.getElementById("subnav_right").innerHTML = subnavHTML;
                }
                function clearAllNavClasses() {
                    document.getElementById('nav_learn').className = '';
                    document.getElementById('nav_connect').className = '';
                    document.getElementById('nav_stories').className = '';
                }
            </script>
        {% endblock %}

        {% block extra-js %}        
        {% endblock %}
    </body>
</html>
